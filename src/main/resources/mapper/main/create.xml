<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dhn.client.create.mapper.SendRequest">
    <select id="tableCheck" parameterType="com.dhn.client.bean.SQLParameter" resultType="int">
        SELECT COUNT(1)
        FROM information_schema.tables
        WHERE table_schema = DATABASE()
        AND table_name = #{msg_table}
    </select>

    <update id="tableCreate" parameterType="com.dhn.client.bean.SQLParameter">
        CREATE TABLE `${msg_table}` (
            `ID` bigint(20) NOT NULL AUTO_INCREMENT,
            `MSG_ID` varchar(40) NOT NULL,
            `MESSAGE_TYPE` varchar(4) NOT NULL,
            `MESSAGE` varchar(4000) DEFAULT NULL,
            `STATUS` varchar(1) DEFAULT '0',
            `P_INVOICE` varchar(100) DEFAULT NULL,
            `PHN` varchar(15) NOT NULL,
            `SMS_SENDER` varchar(15) DEFAULT NULL,
            `REG_DT` datetime NOT NULL DEFAULT current_timestamp(),
            `RESERVE_DT` varchar(15) NOT NULL DEFAULT '00000000000000',
            `RESPONSE_DT` datetime DEFAULT NULL,
            `RESULT_DT` varchar(30) DEFAULT NULL,
            `BUTTON1` varchar(300) DEFAULT NULL,
            `BUTTON2` varchar(300) DEFAULT NULL,
            `BUTTON3` varchar(300) DEFAULT NULL,
            `BUTTON4` varchar(300) DEFAULT NULL,
            `BUTTON5` varchar(300) DEFAULT NULL,
            `TMPL_ID` varchar(100) DEFAULT NULL,
            `PROFILE` varchar(40) DEFAULT NULL,
            `TITLE` varchar(50) DEFAULT NULL,
            `HEADER` varchar(50) DEFAULT NULL,
            `AD_FLAG` varchar(1) DEFAULT 'N',
            `FI_IMAGE_PATH` varchar(200) DEFAULT NULL,
            `IMAGE_LINK` varchar(200) DEFAULT NULL,
            `IMAGE_URL` varchar(200) DEFAULT NULL,
            `WIDE` varchar(1) DEFAULT 'N',
            `LINK` varchar(300) DEFAULT NULL,
            `ATTACHMENTS` varchar(1000) DEFAULT NULL,
            `MSG` varchar(4000) DEFAULT NULL,
            `SMS_KIND` varchar(1) DEFAULT NULL,
            `SMSLMS_TIT` varchar(100) DEFAULT NULL,
            `MMS_IMAGE_KEY` VARCHAR(100) DEFAULT NULL,
            `MMS_IMAGE1` VARCHAR(200) DEFAULT NULL,
            `MMS_IMAGE2` VARCHAR(200) DEFAULT NULL,
            `MMS_IMAGE3` VARCHAR(200) DEFAULT NULL,
            `SEND_GROUP` varchar(50) DEFAULT NULL,
            `RESULT` varchar(5) DEFAULT NULL,
            `RESULT_MSG` varchar(5) DEFAULT NULL,
            `TELCOINFO` varchar(5) DEFAULT NULL,
            `REAL_MESSAGE_TYPE` varchar(4) DEFAULT NULL,
            `REAL_SEND_FLAG` varchar(4) DEFAULT NULL,
            `ETC1` varchar(100) DEFAULT NULL,
            `ETC2` varchar(100) DEFAULT NULL,
            `ETC3` varchar(100) DEFAULT NULL,
            `ETC4` varchar(100) DEFAULT NULL,
            `ETC5` varchar(100) DEFAULT NULL,
            PRIMARY KEY (`id`),
            KEY `${msg_table}_IDX1` (`SEND_GROUP`,`MESSAGE_TYPE`,`SMS_KIND`,`RESERVE_DT`) USING BTREE,
            KEY `${msg_table}_IDX2` (`STATUS`,`SEND_GROUP`,`MESSAGE_TYPE`) USING BTREE,
            KEY `${msg_table}_MSGID_IDX` (`MSG_ID`) USING BTREE
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
    </update>

    <select id="logTableCheck" parameterType="com.dhn.client.bean.SQLParameter" resultType="int">
        SELECT COUNT(1)
        FROM information_schema.tables
        WHERE table_schema = DATABASE()
          AND table_name = #{log_table}
    </select>

    <update id="logTableCreate" parameterType="map">
        CREATE TABLE `${log_table}` AS
        SELECT * FROM `${msg_table}` WHERE 1=0
    </update>
</mapper>
