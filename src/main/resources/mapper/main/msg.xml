<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dhn.client.msg.mapper.SendRequest">
    <select id="req_sms_count" parameterType = "com.dhn.client.bean.SQLParameter" resultType = "int">
        <choose>
            <when test="database == 'oracle'">
                SELECT count(1) AS cnt
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= SYSDATE
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
            </when>
            <when test="database == 'mysql'">
                SELECT count(1) AS cnt
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= NOW()
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
            </when>
        </choose>
    </select>

    <update id="req_sms_group_update" parameterType = "com.dhn.client.bean.SQLParameter" >
        <choose>
            <when test="database == 'oracle'">
                UPDATE ${msg_table}
                SET STATUS = '1',
                    SEND_GROUP = #{group_no}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= SYSDATE
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    AND ROWNUM &lt;= 200
            </when>
            <when test="database == 'mysql'">
                UPDATE ${msg_table}
                SET STATUS = '1',
                    SEND_GROUP = #{group_no}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= NOW()
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                LIMIT 200
            </when>
        </choose>
    </update>

    <select id="req_sms_select" parameterType = "com.dhn.client.bean.SQLParameter" resultType= "com.dhn.client.bean.RequestBean">
        <choose>
            <when test="database == 'oracle'">
                SELECT
                    MSG_ID AS msgid,
                    'PH' AS messagetype,
                    MSG AS msg,
                    MSG AS msgsms,
                    PHN AS phn,
                    P_INVOICE as pinvoice,
                    SMS_SENDER AS smssender,
                    SMSLMS_TIT AS smslmstit,
                    SMS_KIND AS smskind,
                    KISA_CODE as kisacode,
                    TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS') AS regdt,
                    '00000000000000' AS reservedt
                from ${msg_table}
                where SEND_GROUP = #{group_no}
            </when>
            <when test="database == 'mysql'">
                SELECT
                    MSG_ID AS msgid,
                    'PH' AS messagetype,
                    MSG AS msg,
                    MSG AS msgsms,
                    PHN AS phn,
                    P_INVOICE as pinvoice,
                    SMS_SENDER AS smssender,
                    SMSLMS_TIT AS smslmstit,
                    SMS_KIND AS smskind,
                    KISA_CODE as kisacode,
                    DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%s') AS regdt,
                    '00000000000000' AS reservedt
                from ${msg_table}
                where SEND_GROUP = #{group_no}
            </when>
        </choose>
    </select>

    <update id="req_sent_complete" parameterType = "com.dhn.client.bean.SQLParameter" >
        <choose>
            <when test="database == 'oracle'">
                UPDATE ${msg_table}
                    SET STATUS = '2',
                    RESPONSE_DT = CURRENT_TIMESTAMP
                WHERE SEND_GROUP = #{group_no}
            </when>
            <when test="database == 'mysql'">
                UPDATE ${msg_table}
                    SET STATUS = '2',
                    RESPONSE_DT = CURRENT_TIMESTAMP
                WHERE SEND_GROUP = #{group_no}
            </when>
        </choose>
    </update>

    <update id="req_sent_init" parameterType = "com.dhn.client.bean.SQLParameter" >
        <choose>
            <when test="database == 'oracle'">
                UPDATE ${msg_table}
                SET STATUS = '0',
                    SEND_GROUP = NULL,
                    RESPONSE_DT = NULL
                WHERE SEND_GROUP = #{group_no}
            </when>
            <when test="database == 'mysql'">
                UPDATE ${msg_table}
                SET STATUS = '0',
                    SEND_GROUP = NULL,
                    RESPONSE_DT = NULL
                WHERE SEND_GROUP = #{group_no}
            </when>
        </choose>
    </update>

    <update id="msgResultUpdate" parameterType="com.dhn.client.bean.Msg_Log">
        <choose>
            <when test="database == 'oracle'">
                UPDATE ${msg_table}
                SET STATUS = '${status}',
                    RESULT_DT = '${result_dt}',
                    RESULT_MSG = '${code}',
                    RESULT_MESSAGE = '${result_message}',
                    TELCOINFO = '${telecom}',
                    REAL_MESSAGE_TYPE = '${real_send_type}'
                WHERE MSG_ID = #{msgid}
            </when>
            <when test="database == 'mysql'">
                UPDATE ${msg_table}
                SET STATUS = '${status}',
                    RESULT_DT = '${result_dt}',
                    RESULT_MSG = '${code}',
                    RESULT_MESSAGE = '${result_message}',
                    TELCOINFO = '${telecom}',
                    REAL_MESSAGE_TYPE = '${real_send_type}'
                WHERE MSG_ID = #{msgid}
            </when>
        </choose>
    </update>

    <insert id="msgLogInsert" parameterType="com.dhn.client.bean.Msg_Log">
        <choose>
            <when test="database == 'oracle'">
                INSERT INTO ${log_table}
                (
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                )
                SELECT
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                FROM ${msg_table}
                WHERE MSG_ID = #{msgid}
            </when>
            <when test="database == 'mysql'">
                INSERT INTO ${log_table}
                (
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                )
                SELECT
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                FROM ${msg_table}
                WHERE MSG_ID = #{msgid}
            </when>
        </choose>
    </insert>

    <delete id="msgResultDelete" parameterType="com.dhn.client.bean.Msg_Log">
        <choose>
            <when test="database == 'oracle'">
                DELETE FROM ${msg_table}
                WHERE MSG_ID = #{msgid}
            </when>
            <when test="database == 'mysql'">
                DELETE FROM ${msg_table}
                WHERE MSG_ID = #{msgid}
            </when>
        </choose>
    </delete>

    <select id="msg_log_move_count" parameterType="com.dhn.client.bean.SQLParameter" resultType="int">
        <choose>
            <when test="database == 'oracle'">
                SELECT COUNT(1) as cnt
                FROM ${msg_table}
                WHERE STATUS = '9'
            </when>
            <when test="database == 'mysql'">
                SELECT COUNT(1) as cnt
                FROM ${msg_table}
                WHERE STATUS = '9'
            </when>
        </choose>
    </select>

    <update id="update_log_move_groupNo" parameterType="com.dhn.client.bean.SQLParameter">
        <choose>
            <when test="database == 'oracle'">
                UPDATE ${msg_table}
                SET SEND_GROUP = #{group_no}
                WHERE STATUS = '9'
                AND ROWNUM &lt; 200
            </when>
            <when test="database == 'mysql'">
                UPDATE ${msg_table}
                SET SEND_GROUP = #{group_no}
                WHERE STATUS = '9'
                LIMIT 200
            </when>
        </choose>
    </update>

    <insert id="log_move_insert" parameterType="com.dhn.client.bean.SQLParameter">

        <choose>
            <when test="database == 'oracle'">
                INSERT INTO ${log_table}
                (
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                )
                SELECT
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                FROM ${msg_table}
                WHERE SEND_GROUP = #{group_no}
            </when>
            <when test="database == 'mysql'">
                INSERT INTO ${log_table}
                (
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                )
                SELECT
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                FROM ${msg_table}
                WHERE SEND_GROUP = #{group_no}
            </when>
        </choose>
    </insert>

    <delete id="log_move_delete" parameterType="com.dhn.client.bean.SQLParameter">
        <choose>
            <when test="database == 'oracle'">
                DELETE FROM ${msg_table}
                WHERE SEND_GROUP = #{group_no}
            </when>
            <when test="database == 'mysql'">
                DELETE FROM ${msg_table}
                WHERE SEND_GROUP = #{group_no}
            </when>
        </choose>
    </delete>

    <select id="req_lms_count" parameterType = "com.dhn.client.bean.SQLParameter" resultType = "int">
        <choose>
            <when test="database == 'oracle'">
                SELECT count(1) AS cnt
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= SYSDATE
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
            </when>
            <when test="database == 'mysql'">
                SELECT count(1) AS cnt
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= NOW()
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
            </when>
        </choose>
    </select>

    <update id="req_lms_group_update" parameterType = "com.dhn.client.bean.SQLParameter" >
        <choose>
            <when test="database == 'oracle'">
                UPDATE ${msg_table}
                    SET STATUS = '1',
                    SEND_GROUP = #{group_no}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= SYSDATE
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    AND ROWNUM &lt;= 200
            </when>
            <when test="database == 'mysql'">
                UPDATE ${msg_table}
                    SET STATUS = '1',
                    SEND_GROUP = #{group_no}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= NOW()
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    LIMIT 200
            </when>
        </choose>
    </update>

    <select id="req_lms_select" parameterType = "com.dhn.client.bean.SQLParameter" resultType= "com.dhn.client.bean.RequestBean">
        <choose>
            <when test="database == 'oracle'">
                SELECT
                    MSG_ID AS msgid,
                    'PH' AS messagetype,
                    MSG AS msg,
                    MSG AS msgsms,
                    PHN AS phn,
                    P_INVOICE as pinvoice,
                    SMS_SENDER AS smssender,
                    SMSLMS_TIT AS smslmstit,
                    'L' AS smskind,
                    KISA_CODE as kisacode,
                    TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS') AS regdt,
                    '00000000000000' AS reservedt
                from ${msg_table}
                where SEND_GROUP = #{group_no}
            </when>
            <when test="database == 'mysql'">
                SELECT
                    MSG_ID AS msgid,
                    'PH' AS messagetype,
                    MSG AS msg,
                    MSG AS msgsms,
                    PHN AS phn,
                    P_INVOICE as pinvoice,
                    SMS_SENDER AS smssender,
                    SMSLMS_TIT AS smslmstit,
                    'L' AS smskind,
                    KISA_CODE as kisacode,
                    DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%s') AS regdt,
                    '00000000000000' AS reservedt
                from ${msg_table}
                where SEND_GROUP = #{group_no}
            </when>
        </choose>
    </select>

    <select id="req_mms_count" parameterType = "com.dhn.client.bean.SQLParameter" resultType = "int">
        <choose>
            <when test="database == 'oracle'">
                SELECT count(1) AS cnt
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= SYSDATE
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    AND MMS_IMAGE_KEY IS NOT NULL
            </when>
            <when test="database == 'mysql'">
                SELECT count(1) AS cnt
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= NOW()
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    AND MMS_IMAGE_KEY IS NOT NULL
            </when>
        </choose>
    </select>

    <update id="req_mms_group_update" parameterType = "com.dhn.client.bean.SQLParameter" >
        <choose>
            <when test="database == 'oracle'">
                UPDATE ${msg_table}
                    SET STATUS = '1',
                    SEND_GROUP = #{group_no}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= SYSDATE
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    AND MMS_IMAGE_KEY IS NOT NULL
                    AND ROWNUM &lt;= 200
            </when>
            <when test="database == 'mysql'">
                UPDATE ${msg_table}
                    SET STATUS = '1',
                    SEND_GROUP = #{group_no}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= NOW()
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    AND MMS_IMAGE_KEY IS NOT NULL
                    LIMIT 200
            </when>
        </choose>
    </update>

    <select id="req_mms_select" parameterType = "com.dhn.client.bean.SQLParameter" resultType= "com.dhn.client.bean.RequestBean">
        <choose>
            <when test="database == 'oracle'">
                SELECT
                    MSG_ID AS msgid,
                    'PH' AS messagetype,
                    MSG AS msg,
                    MSG AS msgsms,
                    PHN AS phn,
                    P_INVOICE as pinvoice,
                    SMS_SENDER AS smssender,
                    SMSLMS_TIT AS smslmstit,
                    'M' AS smskind,
                    MMS_IMAGE_KEY AS mmsimageid,
                    KISA_CODE as kisacode,
                    TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS') AS regdt,
                    '00000000000000' AS reservedt
                from ${msg_table}
                where SEND_GROUP = #{group_no}
            </when>
            <when test="database == 'mysql'">
                SELECT
                    MSG_ID AS msgid,
                    'PH' AS messagetype,
                    MSG AS msg,
                    MSG AS msgsms,
                    PHN AS phn,
                    P_INVOICE as pinvoice,
                    SMS_SENDER AS smssender,
                    SMSLMS_TIT AS smslmstit,
                    'M' AS smskind,
                    MMS_IMAGE_KEY AS mmsimageid,
                    KISA_CODE as kisacode,
                    DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%s') AS regdt,
                    '00000000000000' AS reservedt
                from ${msg_table}
                where SEND_GROUP = #{group_no}
            </when>
        </choose>
    </select>

    <select id="req_mms_image_count" parameterType = "com.dhn.client.bean.SQLParameter" resultType = "int">
        <choose>
            <when test="database == 'oracle'">
                SELECT count(1) AS cnt
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= SYSDATE
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    AND MMS_IMAGE_KEY IS NULL
            </when>
            <when test="database == 'mysql'">
                SELECT count(1) AS cnt
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= NOW()
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    AND MMS_IMAGE_KEY IS NULL
            </when>
        </choose>
    </select>

    <select id="req_mms_image" parameterType = "com.dhn.client.bean.SQLParameter" resultType = "com.dhn.client.bean.ImageBean">
        <choose>
            <when test="database == 'oracle'">
                SELECT
                    MSG_ID AS msgid,
                    MMS_IMAGE1 AS file1,
                    MMS_IMAGE2 AS file2,
                    MMS_IMAGE3 AS file3
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= SYSDATE
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    AND MMS_IMAGE_KEY IS NULL
            </when>
            <when test="database == 'mysql'">
                SELECT
                    MSG_ID AS msgid,
                    MMS_IMAGE1 AS file1,
                    MMS_IMAGE2 AS file2,
                    MMS_IMAGE3 AS file3
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= NOW()
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND = #{sms_kind}
                    AND SEND_GROUP IS NULL
                    AND MMS_IMAGE_KEY IS NULL
            </when>
        </choose>
    </select>

    <update id="req_mms_key_update" parameterType = "com.dhn.client.bean.SQLParameter">
        <choose>
            <when test="database == 'oracle'">
                UPDATE ${msg_table}
                SET MMS_IMAGE_KEY = #{mms_key}
                WHERE MSG_ID = #{msgid}
            </when>
            <when test="database == 'mysql'">
                UPDATE ${msg_table}
                SET MMS_IMAGE_KEY = #{mms_key}
                WHERE MSG_ID = #{msgid}
            </when>
        </choose>
    </update>

    <update id="mms_image_fail_update" parameterType = "com.dhn.client.bean.SQLParameter" >
        <choose>
            <when test="database == 'oracle'">
                UPDATE ${msg_table}
                SET RESULT = '${msg_image_code}',
                    RESULT_MESSAGE = '이미지 등록 실패',
                    RESULT_DT = TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS'),
                    STATUS = 'F'
                WHERE MSG_ID = #{msgid}
            </when>
            <when test="database == 'mysql'">
                UPDATE ${msg_table}
                SET RESULT = '${msg_image_code}',
                    RESULT_MESSAGE = '이미지 등록 실패',
                    RESULT_DT = NOW(),
                    STATUS = 'F'
                WHERE MSG_ID = #{msgid}
            </when>
        </choose>
    </update>

    <insert id="mms_image_fail_log_Insert" parameterType="com.dhn.client.bean.SQLParameter">
        <choose>
            <when test="database == 'oracle'">
                INSERT INTO ${log_table}
                (
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                )
                SELECT
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                FROM ${msg_table}
                WHERE MSG_ID = #{msgid}
            </when>
            <when test="database == 'mysql'">
                INSERT INTO ${log_table}
                (
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                )
                SELECT
                    ID,
                    MSG_ID,
                    MESSAGE_TYPE,
                    MESSAGE,
                    STATUS,
                    P_INVOICE,
                    PHN,
                    SMS_SENDER,
                    REG_DT,
                    RESERVE_DT,
                    RESPONSE_DT,
                    RESULT_DT,
                    BUTTON1,
                    BUTTON2,
                    BUTTON3,
                    BUTTON4,
                    BUTTON5,
                    TMPL_ID,
                    PROFILE,
                    TITLE,
                    HEADER,
                    AD_FLAG,
                    FI_IMAGE_PATH,
                    IMAGE_LINK,
                    IMAGE_URL,
                    WIDE,
                    LINK,
                    ATTACHMENTS,
                    MSG,
                    SMS_KIND,
                    SMSLMS_TIT,
                    MMS_IMAGE_KEY,
                    MMS_IMAGE1,
                    MMS_IMAGE2,
                    MMS_IMAGE3,
                    SEND_GROUP,
                    RESULT,
                    RESULT_MSG,
                    RESULT_MESSAGE,
                    TELCOINFO,
                    REAL_MESSAGE_TYPE,
                    REAL_SEND_FLAG,
                    KISA_CODE,
                    ETC1,
                    ETC2,
                    ETC3,
                    ETC4,
                    ETC5,
                    KIND,
                    SUPPLEMENT,
                    CURRENCY_TYPE,
                    ATT_MESSAGE,
                    ATT_BUTTON,
                    ATT_IMAGE,
                    ATT_ITEM,
                    ATT_COUPON,
                    ATT_COMMERCE,
                    ATT_VIDEO,
                    CAR_HEAD,
                    CAR_LIST,
                    CAR_TAIL,
                    GROUP_TAG,
                    BCAST_CNT,
                    USER_KEY,
                    PUSH_ALARM
                FROM ${msg_table}
                WHERE MSG_ID = #{msgid}
            </when>
        </choose>
    </insert>

    <delete id="mms_image_fail_delete" parameterType="com.dhn.client.bean.SQLParameter">
        <choose>
            <when test="database == 'oracle'">
                DELETE FROM ${msg_table}
                WHERE MSG_ID = #{msgid}
            </when>
            <when test="database == 'mysql'">
                DELETE FROM ${msg_table}
                WHERE MSG_ID = #{msgid}
            </when>
        </choose>
    </delete>

    <select id="req_otp_count" parameterType = "com.dhn.client.bean.SQLParameter" resultType = "int">
        <choose>
            <when test="database == 'oracle'">
                SELECT count(1) AS cnt
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= SYSDATE
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND IN ('S','L')
                    AND SEND_GROUP IS NULL
            </when>
            <when test="database == 'mysql'">
                SELECT count(1) AS cnt
                FROM ${msg_table}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= NOW()
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND IN ('S','L')
                    AND SEND_GROUP IS NULL
            </when>
        </choose>
    </select>

    <update id="req_otp_group_update" parameterType = "com.dhn.client.bean.SQLParameter" >
        <choose>
            <when test="database == 'oracle'">
                UPDATE ${msg_table}
                SET STATUS = '1',
                    SEND_GROUP = #{group_no}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= SYSDATE
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND IN ('S','L')
                    AND SEND_GROUP IS NULL
                    AND ROWNUM &lt;= 200
            </when>
            <when test="database == 'mysql'">
                UPDATE ${msg_table}
                SET STATUS = '1',
                    SEND_GROUP = #{group_no}
                WHERE STATUS = '0'
                    AND RESERVE_DT &lt;= NOW()
                    AND MESSAGE_TYPE = #{msg_type}
                    AND SMS_KIND IN ('S','L')
                    AND SEND_GROUP IS NULL
                LIMIT 200
            </when>
        </choose>
    </update>

    <select id="req_otp_select" parameterType = "com.dhn.client.bean.SQLParameter" resultType= "com.dhn.client.bean.RequestBean">
        <choose>
            <when test="database == 'oracle'">
                SELECT
                    MSG_ID AS msgid,
                    'OT' AS messagetype,
                    MSG AS msg,
                    MSG AS msgsms,
                    PHN AS phn,
                    P_INVOICE as pinvoice,
                    SMS_SENDER AS smssender,
                    SMSLMS_TIT AS smslmstit,
                    SMS_KIND AS smskind,
                    KISA_CODE as kisacode,
                    TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS') AS regdt,
                    '00000000000000' AS reservedt
                from ${msg_table}
                where SEND_GROUP = #{group_no}
            </when>
            <when test="database == 'mysql'">
                SELECT
                    MSG_ID AS msgid,
                    'OT' AS messagetype,
                    MSG AS msg,
                    MSG AS msgsms,
                    PHN AS phn,
                    P_INVOICE as pinvoice,
                    SMS_SENDER AS smssender,
                    SMSLMS_TIT AS smslmstit,
                    SMS_KIND AS smskind,
                    KISA_CODE as kisacode,
                    DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%s') AS regdt,
                    '00000000000000' AS reservedt
                from ${msg_table}
                where SEND_GROUP = #{group_no}
            </when>
        </choose>
    </select>

</mapper>